# Báo cáo Kết quả Pentest (Pentest Report)

**Ngày thực hiện:** 12/01/2026
**Đối tượng:** Ứng dụng StudyLanguage (API & Web)
**Người thực hiện:** Antigravity Pentest Team

## 1. Tóm tắt điều hành (Executive Summary)
Quá trình kiểm thử bảo mật đã phát hiện **03 lỗ hổng nghiêm trọng (Critical/High)** có thể dẫn đến việc lộ dữ liệu, lạm dụng tài nguyên AI (tốn chi phí OpenAI API) và tấn công từ chối dịch vụ.
Hệ thống Backend (NestJS) hiện tại **hoàn toàn không có cơ chế xác thực** cho các API quan trọng.

## 2. Chi tiết các lỗ hổng (Findings)

### [CRITICAL] API-AUTH-01: Không có xác thực (Missing Authentication)
*   **Mô tả**: Các endpoint API quan trọng như `/api/ai/generate-text`, `/api/ai/generate-conversation` có thể được gọi tự do mà không cần Token hay API Key.
*   **Bằng chứng (Evidence)**:
    *   Script kiểm thử (`scripts/pentest_backend.js`) đã gọi thành công API mà không có Header Authorization.
    *   Code Review (`apps/api/src/ai/ai.controller.ts`) cho thấy không sử dụng `@UseGuards()`.
*   **Rủi ro**: Kẻ tấn công có thể spam API, làm cạn kiệt hạn mức OpenAI của bạn ($$$) hoặc phá hoại cơ sở dữ liệu.
*   **Khuyến nghị**:
    *   Triển khai `AuthGuard` của NestJS (tích hợp Supabase Auth hoặc JWT).
    *   Yêu cầu `Bearer Token` cho tất cả các endpoint `/ai/*`.

### [HIGH] API-VAL-01: Thiếu kiểm soát dữ liệu đầu vào (Missing Input Validation)
*   **Mô tả**: API không kiểm tra kỹ dữ liệu gửi lên.
*   **Bằng chứng**:
    *   File `apps/api/src/main.ts` không cấu hình `app.useGlobalPipes(new ValidationPipe())`.
    *   Mặc dù có DTO (`apps/api/src/ai/ai.controller.ts`), nhưng các decorator như `@IsString()`, `@IsInt()` sẽ bị bỏ qua nếu không kích hoạt Global Pipe.
*   **Rủi ro**: Gây lỗi server (500 Error), làm sai lệch logic, hoặc tấn công DoS.
*   **Khuyến nghị**:
    *   Kích hoạt `ValidationPipe` toàn cục.
    *   Thêm chặt chẽ các rules validation trong DTO.

### [HIGH] API-INFO-01: Cấu hình CORS không an toàn cho Production
*   **Mô tả**: CORS đang được hardcode chỉ cho `localhost`.
*   **Bằng chứng**: `apps/api/src/main.ts`: `origin: ['http://localhost:3000', 'http://localhost:8081']`.
*   **Rủi ro**: Khi deploy lên server thật (Vercel, VPS), Frontend sẽ không gọi được API, hoặc nếu cấu hình sai (`*`) sẽ lỏng lẻo bảo mật.
*   **Khuyến nghị**: Sử dụng biến môi trường `CORS_ORIGINS` để cấu hình động.

### [MEDIUM] WEB-SEC-01: API Calls từ Client-side chưa bảo mật
*   **Mô tả**: Frontend (`interactive-listening.tsx`) gọi trực tiếp `http://localhost:3001` mà không kèm Auth header.
*   **Rủi ro**: Phụ thuộc vào vấn đề [API-AUTH-01]. Nếu Backend bật Auth, Frontend hiện tại sẽ hỏng ngay lập tức.
*   **Khuyến nghị**:
    *   Cập nhật Frontend để lấy Session Token từ Supabase và gửi kèm request (`Authorization: Bearer ...`).

## 3. Kết luận
Hệ thống đang ở giai đoạn phát triển đầu (MVP) nên việc thiếu sót bảo mật là dễ hiểu, nhưng cần khắc phục ngay lập tức các lỗi **CRITICAL** trước khi public hoặc tích hợp sâu hơn.

---
**Đề xuất hành động tiếp theo:**
1.  Bật `ValidationPipe` ngay lập tức.
2.  Cài đặt `Passport Strategy` (Supabase) cho NestJS Guard.
3.  Sửa Frontend để gửi Token.
