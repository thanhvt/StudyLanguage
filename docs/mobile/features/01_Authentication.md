# ğŸ” Authentication Feature - Mobile

> **Module:** Authentication  
> **Priority:** P0 (Core)  
> **Phase:** MVP

---

## 1. Overview

Há»‡ thá»‘ng xÃ¡c thá»±c cho mobile app vá»›i trá»ng tÃ¢m vÃ o tráº£i nghiá»‡m nhanh gá»n, báº£o máº­t, vÃ  há»— trá»£ Ä‘Äƒng nháº­p láº¡i tá»± Ä‘á»™ng.

### 1.1 Auth Methods

| Method | Priority | Use Case |
|--------|----------|----------|
| **Google OAuth** | Primary | ÄÄƒng nháº­p nhanh, Ä‘Ã£ cÃ³ Google account |
| **Magic Link** | Secondary | Thiáº¿t bá»‹ láº¡, khÃ´ng cÃ³ Google |
| **Biometric** | Optional | ÄÄƒng nháº­p nhanh láº§n sau |
| **Auto-Relogin** | Background | Token refresh tá»± Ä‘á»™ng |

---

## 2. User Flows

### 2.1 First Launch Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚ [Splash Screen]  â†’  [Onboarding 1-3]  â†’  [Auth Screen]     â”‚
â”‚   (Logo + Anim)      (3 slides)           (Login options)  â”‚
â”‚        â”‚                  â”‚                    â”‚            â”‚
â”‚        â””â”€â”€â”€â”€ 1-2s â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€ swipe â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Google OAuth Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚ [Tap Google]  â†’  [WebView OAuth]  â†’  [Callback]  â†’  [Home] â”‚
â”‚                      â”‚                   â”‚                  â”‚
â”‚                      â””â”€â”€ Google UI â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â”‚  Technical:                                                 â”‚
â”‚  - Expo AuthSession + Supabase Auth                         â”‚
â”‚  - Token â†’ SecureStore                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Magic Link Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚ [Enter Email]  â†’  [Send Link]  â†’  [Check Email]  â†’  [Home] â”‚
â”‚                        â”‚               â”‚                    â”‚
â”‚                        â””â”€â”€â”€ Supabase â”€â”€â”˜                    â”‚
â”‚                              email                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 Biometric Flow (Return User)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚ [App Launch]  â†’  [Biometric Prompt]  â†’  [Verify]  â†’  [Home]â”‚
â”‚                        â”‚                   â”‚                â”‚
â”‚                   Face ID /            SecureStore          â”‚
â”‚                  Fingerprint            verify              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. UI Mockups

### 3.1 Splash Screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚         ğŸ“š                      â”‚
â”‚    StudyLanguage               â”‚
â”‚                                 â”‚
â”‚        [Loading...]             â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specs:**
- Duration: 1-2 giÃ¢y
- Logo animation: Scale up + fade in
- Background: Brand gradient

### 3.2 Onboarding Screens

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚     â”‚                                 â”‚
â”‚         ğŸ“                      â”‚     â”‚    ğŸ§ ğŸ—£ï¸ ğŸ“– âœï¸                 â”‚
â”‚                                 â”‚     â”‚                                 â”‚
â”‚   Xin chÃ o!                    â”‚     â”‚   4 Ká»¹ nÄƒng vá»›i AI             â”‚
â”‚                                 â”‚     â”‚                                 â”‚
â”‚   Sáºµn sÃ ng há»c tiáº¿ng Anh?      â”‚     â”‚   Listening â€¢ Speaking          â”‚
â”‚                                 â”‚     â”‚   Reading â€¢ Writing             â”‚
â”‚                                 â”‚     â”‚                                 â”‚
â”‚         â—‹ â—‹ â—‹                   â”‚     â”‚         â—‹ â— â—‹                   â”‚
â”‚                                 â”‚     â”‚                                 â”‚
â”‚       [Tiáº¿p tá»¥c â†’]              â”‚     â”‚       [Tiáº¿p tá»¥c â†’]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         ğŸŒ                      â”‚
â”‚                                 â”‚
â”‚   Há»c má»i lÃºc, má»i nÆ¡i         â”‚
â”‚                                 â”‚
â”‚   Online & Offline             â”‚
â”‚   Sync má»i thiáº¿t bá»‹             â”‚
â”‚                                 â”‚
â”‚         â—‹ â—‹ â—                   â”‚
â”‚                                 â”‚
â”‚     [Báº¯t Ä‘áº§u ngay â†’]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specs:**
- Swipeable PageView
- Skip button (optional)
- Dot indicators

### 3.3 Auth Screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         ğŸ“š                      â”‚
â”‚    StudyLanguage               â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ”µ Tiáº¿p tá»¥c vá»›i Google â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“§ ÄÄƒng nháº­p báº±ng Emailâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚           ChÃ­nh sÃ¡ch            â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Specs:**
- Google button: Primary, prominent
- Email button: Secondary style
- Policy links at bottom

### 3.4 Magic Link Input

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ÄÄƒng nháº­p báº±ng Email        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  Email cá»§a báº¡n                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ example@email.com       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Gá»­i link           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚  ğŸ’¡ ChÃºng tÃ´i sáº½ gá»­i 1 link    â”‚
â”‚     Ä‘Äƒng nháº­p Ä‘áº¿n email cá»§a báº¡n â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 Biometric Prompt

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚         ğŸ“š                      â”‚
â”‚    StudyLanguage               â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚      ğŸ‘†                  â”‚   â”‚
â”‚  â”‚   Face ID / Touch ID    â”‚   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚  XÃ¡c thá»±c Ä‘á»ƒ tiáº¿p tá»¥c   â”‚   â”‚
â”‚  â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚
â”‚      [DÃ¹ng máº­t kháº©u khÃ¡c]       â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Technical Implementation

### 4.1 Storage Strategy

| Data | Storage | Reason |
|------|---------|--------|
| Access Token | SecureStore | Encrypted, secure |
| Refresh Token | SecureStore | Encrypted, secure |
| User Profile | AsyncStorage | Quick access |
| Auth State | Zustand (memory) | Fast UI updates |

### 4.2 Libraries

```typescript
// Required packages
expo-auth-session        // OAuth flows
expo-secure-store        // Token storage
expo-local-authentication // Biometric
@supabase/supabase-js    // Auth provider
```

### 4.3 Auth Context Structure

```typescript
interface AuthState {
  user: User | null;
  session: Session | null;
  loading: boolean;
  
  // Actions
  signInWithGoogle: () => Promise<void>;
  signInWithMagicLink: (email: string) => Promise<void>;
  signOut: () => Promise<void>;
  enableBiometric: () => Promise<void>;
}
```

### 4.4 Token Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚ [App Start]  â†’  [Check Token]  â†’  [Valid?]  â†’  [Home]      â”‚
â”‚                       â”‚              â”‚                      â”‚
â”‚                       â”‚         [Expired?]                  â”‚
â”‚                       â”‚              â”‚                      â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â–º  [Refresh]  â†’  [Home]       â”‚
â”‚                                    â”‚                        â”‚
â”‚                               [Fail?]                       â”‚
â”‚                                    â”‚                        â”‚
â”‚                               [Login Screen]                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Error Handling

| Error | UI Response |
|-------|-------------|
| Google OAuth cancelled | Toast: "ÄÃ£ há»§y Ä‘Äƒng nháº­p" |
| Network error | Alert + Retry button |
| Invalid magic link | Screen: "Link Ä‘Ã£ háº¿t háº¡n" + Resend |
| Biometric failed | Fallback to password/retry |
| Account not found | Create account option |

---

## 6. Security Considerations

### 6.1 Best Practices
- âœ… Tokens stored in SecureStore (encrypted)
- âœ… No sensitive data in AsyncStorage
- âœ… HTTPS only for all API calls
- âœ… Session timeout after 30 days inactivity
- âœ… Biometric data never leaves device

### 6.2 Permission Handling
- Biometric: Ask once, explain why
- Save preference in settings

---

## 7. Implementation Tasks

### MVP Phase
- [ ] Setup Expo AuthSession
- [ ] Implement Google OAuth flow
- [ ] Create auth screens (Splash, Onboarding, Login)
- [ ] Token storage with SecureStore
- [ ] Auto-relogin on app start
- [ ] Magic Link flow

### Enhanced Phase
- [ ] Biometric login setup
- [ ] Settings: Enable/disable biometric
- [ ] Session management UI

---

## 8. Related Documents

- [00_Mobile_Overview.md](../00_Mobile_Overview.md) - Project overview
- [08_Profile_Settings.md](08_Profile_Settings.md) - Settings for auth preferences
- [Architecture.md](../technical/Architecture.md) - Technical details
